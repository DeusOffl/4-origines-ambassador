<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ambassadeur 4 Origines</title>
    
    <!-- Pico.css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Custom styles -->
    <style>
        :root {
            --primary-color: #e74c3c;
            --secondary-color: #2c3e50;
            --accent-color: #f39c12;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --error-color: #e74c3c;
        }
        
        .hero-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            text-align: center;
            padding: 4rem 1rem;
            margin-bottom: 2rem;
        }
        
        .hero-title {
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        
        .hero-subtitle {
            font-size: 1.25rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .metric-card {
            background: var(--card-background-color);
            border: 1px solid var(--card-border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.8;
        }
        
        .referral-section {
            background: var(--card-background-color);
            border: 1px solid var(--card-border-color);
            border-radius: 0.5rem;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .referral-link {
            background: var(--code-background-color);
            border: 1px solid var(--form-element-border-color);
            border-radius: 0.25rem;
            padding: 0.75rem;
            font-family: monospace;
            word-break: break-all;
            margin: 1rem 0;
        }
        
        .social-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        .social-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            text-decoration: none;
            color: white;
            font-weight: 500;
            transition: opacity 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .social-btn:hover {
            opacity: 0.8;
            color: white;
        }
        
        .facebook { background-color: #1877f2; }
        .instagram { background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); }
        .whatsapp { background-color: #25d366; }
        .twitter { background-color: #1da1f2; }
        
        .admin-table {
            width: 100%;
            margin-top: 2rem;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            opacity: 0.6;
        }
        
        .hidden {
            display: none !important;
        }
        
        footer {
            margin-top: 4rem;
            padding: 2rem 0;
            border-top: 1px solid var(--card-border-color);
            text-align: center;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2rem;
            }
            
            .hero-subtitle {
                font-size: 1.1rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .social-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body x-data="app" x-init="init()">
    <main class="container">
        <!-- Loading State -->
        <div x-show="loading" class="loading">
            <div aria-busy="true">Chargement...</div>
        </div>
        
        <!-- Landing Page -->
        <div x-show="!loading && !user && currentRoute === 'landing'" id="landing-page">
            <div class="hero-section">
                <h1 class="hero-title">Ambassadeur 4 Origines</h1>
                <p class="hero-subtitle">Deviens ambassadeur 4O et b√©n√©ficie de primes et r√©ductions chez nous quand tu t'affiches ici!</p>
                <button @click="signInWithGoogle" class="contrast" style="font-size: 1.2rem; padding: 1rem 2rem;">
                    Rejoindre
                </button>
            </div>
            
            <div style="text-align: center; margin: 2rem 0;">
                <small>
                    En vous inscrivant, vous acceptez nos 
                    <a href="#" @click.prevent="showTerms = true">conditions g√©n√©rales</a>
                </small>
            </div>
        </div>
        
        <!-- Dashboard -->
        <div x-show="!loading && user && currentRoute === 'dashboard'" id="dashboard">
            <header style="text-align: center; margin-bottom: 2rem;">
                <h1 x-text="`${userProfile?.full_name || 'Ambassadeur'}, Ambassadeur 4 Origines`"></h1>
                <p style="opacity: 0.8;">Bienvenue sur votre tableau de bord</p>
            </header>
            
            <!-- Referral Section -->
            <div class="referral-section">
                <h2>Partager votre lien</h2>
                <p>Rejoins-moi et b√©n√©ficie de primes et r√©ductions chez 4O quand tu t'affiches ici!</p>
                
                <div class="referral-link" x-text="referralUrl"></div>
                
                <div style="display: flex; gap: 1rem; margin: 1rem 0; flex-wrap: wrap;">
                    <button @click="copyReferralLink" :disabled="!referralUrl">
                        Copier le lien
                    </button>
                    <button @click="shareNative" :disabled="!referralUrl" class="secondary">
                        Partager
                    </button>
                </div>
                
                <div class="social-buttons">
                    <a :href="shareUrls.facebook" target="_blank" class="social-btn facebook">
                        üìò Facebook
                    </a>
                    <a :href="shareUrls.instagram" target="_blank" class="social-btn instagram">
                        üì∑ Instagram
                    </a>
                    <a :href="shareUrls.whatsapp" target="_blank" class="social-btn whatsapp">
                        üí¨ WhatsApp
                    </a>
                    <a :href="shareUrls.twitter" target="_blank" class="social-btn twitter">
                        üê¶ Twitter
                    </a>
                </div>
            </div>
            
            <!-- Metrics -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" x-text="stats.referrals"></div>
                    <div class="metric-label">Parrainages</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" x-text="stats.linkViews"></div>
                    <div class="metric-label">Vues du lien</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" x-text="`${stats.totalEarnings}‚Ç¨`"></div>
                    <div class="metric-label">Gains totaux</div>
                </div>
            </div>
        </div>
        
        <!-- Public Profile -->
        <div x-show="!loading && currentRoute.startsWith('profile')" id="public-profile">
            <div x-show="profileUser" class="hero-section">
                <h1 x-text="`${profileUser?.full_name || 'Ambassadeur'} vous invite`"></h1>
                <p class="hero-subtitle">Rejoignez le programme 4 Origines et b√©n√©ficiez de primes et r√©ductions!</p>
                <button @click="signInWithGoogle" class="contrast" style="font-size: 1.2rem; padding: 1rem 2rem;">
                    Rejoindre maintenant
                </button>
            </div>
            
            <div x-show="!profileUser && !loading" style="text-align: center; padding: 4rem 0;">
                <h2>Profil introuvable</h2>
                <p>Ce lien d'ambassadeur n'existe pas ou n'est plus actif.</p>
                <a href="/" role="button">Retour √† l'accueil</a>
            </div>
        </div>
        
        <!-- Admin Panel -->
        <div x-show="!loading && user && currentRoute === 'admin' && userProfile?.is_admin" id="admin-panel">
            <h1>Panneau d'administration</h1>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" x-text="adminStats.totalUsers"></div>
                    <div class="metric-label">Ambassadeurs</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" x-text="adminStats.totalReferrals"></div>
                    <div class="metric-label">Parrainages</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" x-text="adminStats.totalViews"></div>
                    <div class="metric-label">Vues totales</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" x-text="`${adminStats.totalEarnings}‚Ç¨`"></div>
                    <div class="metric-label">Gains totaux</div>
                </div>
            </div>
            
            <div x-show="ambassadors.length > 0">
                <h2>Ambassadeurs</h2>
                <div style="overflow-x: auto;">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Username</th>
                                <th>Code de parrainage</th>
                                <th>Parrainages</th>
                                <th>Vues</th>
                                <th>Gains</th>
                                <th>Inscription</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="ambassador in ambassadors" :key="ambassador.id">
                                <tr>
                                    <td x-text="ambassador.full_name"></td>
                                    <td x-text="ambassador.username"></td>
                                    <td x-text="ambassador.referral_code"></td>
                                    <td x-text="ambassador.referral_count || 0"></td>
                                    <td x-text="ambassador.view_count || 0"></td>
                                    <td x-text="`${ambassador.total_earnings || 0}‚Ç¨`"></td>
                                    <td x-text="new Date(ambassador.created_at).toLocaleDateString('fr-FR')"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Access Denied -->
        <div x-show="!loading && user && currentRoute === 'admin' && !userProfile?.is_admin" style="text-align: center; padding: 4rem 0;">
            <h2>Acc√®s refus√©</h2>
            <p>Vous n'avez pas les permissions n√©cessaires pour acc√©der √† cette page.</p>
            <a href="/" role="button">Retour au tableau de bord</a>
        </div>
    </main>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <div x-show="user" style="text-align: center;">
                <button @click="signOut" class="secondary outline">
                    D√©connexion
                </button>
            </div>
            <p style="margin-top: 1rem;">
                <a href="#" @click.prevent="showTerms = true">Conditions g√©n√©rales</a> | 
                <a href="mailto:contact@4origines.com">Contact</a>
            </p>
        </div>
    </footer>
    
    <!-- Terms Modal -->
    <dialog x-show="showTerms" :open="showTerms">
        <article>
            <header>
                <h3>Conditions g√©n√©rales</h3>
                <button @click="showTerms = false" aria-label="Fermer" class="close"></button>
            </header>
            <main>
                <p>En devenant ambassadeur 4 Origines, vous acceptez de:</p>
                <ul>
                    <li>Promouvoir de mani√®re √©thique les produits et services 4 Origines</li>
                    <li>Respecter les valeurs et l'image de marque de l'entreprise</li>
                    <li>Ne pas utiliser de pratiques trompeuses dans votre promotion</li>
                    <li>D√©clarer vos revenus conform√©ment √† la l√©gislation en vigueur</li>
                </ul>
                <p>Les primes et r√©ductions sont soumises aux conditions sp√©cifiques de chaque offre.</p>
            </main>
            <footer>
                <button @click="showTerms = false">Fermer</button>
            </footer>
        </article>
    </dialog>
    
    <!-- Scripts -->
    <script src="js/supabase-client.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/app.js"></script>
</body>
</html>